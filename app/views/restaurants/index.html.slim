h1 位置情報取得サンプル
button onclick="getPosition();"  位置情報を取得する

= @hentai

button.king sample


div.container-lg.mt-5
  div.row
    div.col-md-12
      - @hash.each do |rest|
        .row.p-4.border.rounded.my-4.shadow.mx-1
          .col-md-4.col-xs-6.text-center
            - if rest[:image_url][:shop_image1].empty?
              img src="https://picsum.photos/id/1/250/250"
            - else
              = image_tag rest[:image_url][:shop_image1], class: 'rounded img-responsive img-thumbnail'

          .col-md-8.p-1
            table.table
                tr
                  th scope="row" name
                  td colspan="3"
                    = rest[:name]
                tr
                  th scope="row" address
                  td
                    = rest[:address]
                tr
                  th scope="row" opentime
                  td
                    = rest[:opentime]
                tr
                  th scope="row" budget
                  td
                    = rest[:budget]

javascript:
  

  // Geolocation APIに対応している
  if (navigator.geolocation) {
    alert("この端末では位置情報が取得できます");
  // Geolocation APIに対応していない
  } else {
    alert("この端末では位置情報が取得できません");
  }

  // 現在地取得処理
  function getPosition() {
    // 現在地を取得
    navigator.geolocation.getCurrentPosition(
      // 取得成功した場合
      function(position) {
          alert("緯度:"+position.coords.latitude+",経度"+position.coords.longitude);

      },
      // 取得失敗した場合
      function(error) {
        switch(error.code) {
          case 1: //PERMISSION_DENIED
            alert("位置情報の利用が許可されていません");
            break;
          case 2: //POSITION_UNAVAILABLE
            alert("現在位置が取得できませんでした");
            break;
          case 3: //TIMEOUT
            alert("タイムアウトになりました");
            break;
          default:
            alert("その他のエラー(エラーコード:"+error.code+")");
            break;
        }
      }
    );
  }


  $('.king').on('click', function() {
    if (navigator.geolocation) {
      alert("この端末では位置情報が取得できます");
    // Geolocation APIに対応していない
    } else {
      alert("この端末では位置情報が取得できません");
    }

    navigator.geolocation.getCurrentPosition(
      // 取得成功した場合
      function(position) {
          alert("緯度:"+position.coords.latitude+",経度"+position.coords.longitude);

          $.ajax({
            url: '/restaurants/index',
            type: 'GET',
            dataType: 'html',
            async: false,
            data: {
              latitude: position.coords.latitude,
              longitude: position.coords.longitude
            },
          });

      },
      // 取得失敗した場合
      function(error) {
        switch(error.code) {
          case 1: //PERMISSION_DENIED
            alert("位置情報の利用が許可されていません");
            break;
          case 2: //POSITION_UNAVAILABLE
            alert("現在位置が取得できませんでした");
            break;
          case 3: //TIMEOUT
            alert("タイムアウトになりました");
            break;
          default:
            alert("その他のエラー(エラーコード:"+error.code+")");
            break;
        }
      }
    );
    //alert("クリックされました");
  });


javascript:

  $(function(){
    $('.nextQuestion').click(function() {

      gon.count += 1;  #もともと0を代入していたgon.countに+1。

      $.ajax({
        url: '/itimon_ittous/update',
        type: 'GET',
        dataType: 'html',
        async: true,
        data: {
          count: gon.count,
          sample: gon.sample
        },
      });
   });
 });
